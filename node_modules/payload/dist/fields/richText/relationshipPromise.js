"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.recurseRichText = void 0;
const recurseNestedFields_1 = require("./recurseNestedFields");
const populate_1 = require("./populate");
const recurseRichText = ({ req, children, payload, overrideAccess = false, depth, currentDepth = 0, field, promises, showHiddenFields, }) => {
    if (Array.isArray(children)) {
        children.forEach((element) => {
            var _a, _b, _c, _d, _e;
            const collection = payload.collections[element === null || element === void 0 ? void 0 : element.relationTo];
            if ((element.type === 'relationship' || element.type === 'upload')
                && ((_a = element === null || element === void 0 ? void 0 : element.value) === null || _a === void 0 ? void 0 : _a.id)
                && collection
                && (depth && currentDepth <= depth)) {
                if (element.type === 'upload' && Array.isArray((_e = (_d = (_c = (_b = field.admin) === null || _b === void 0 ? void 0 : _b.upload) === null || _c === void 0 ? void 0 : _c.collections) === null || _d === void 0 ? void 0 : _d[element === null || element === void 0 ? void 0 : element.relationTo]) === null || _e === void 0 ? void 0 : _e.fields)) {
                    (0, recurseNestedFields_1.recurseNestedFields)({
                        promises,
                        data: element.fields || {},
                        fields: field.admin.upload.collections[element.relationTo].fields,
                        req,
                        payload,
                        overrideAccess,
                        depth,
                        currentDepth,
                        showHiddenFields,
                    });
                }
                promises.push((0, populate_1.populate)({
                    req,
                    id: element.value.id,
                    data: element,
                    key: 'value',
                    overrideAccess,
                    depth,
                    currentDepth,
                    payload,
                    field,
                    collection,
                    showHiddenFields,
                }));
            }
            if (element === null || element === void 0 ? void 0 : element.children) {
                (0, exports.recurseRichText)({
                    req,
                    children: element.children,
                    payload,
                    overrideAccess,
                    depth,
                    currentDepth,
                    field,
                    promises,
                    showHiddenFields,
                });
            }
        });
    }
};
exports.recurseRichText = recurseRichText;
const richTextRelationshipPromise = ({ req, data, payload, overrideAccess, depth, currentDepth, field, showHiddenFields, }) => async () => {
    const promises = [];
    (0, exports.recurseRichText)({
        req,
        children: data[field.name],
        payload,
        overrideAccess,
        depth,
        currentDepth,
        field,
        promises,
        showHiddenFields,
    });
    await Promise.all(promises);
};
exports.default = richTextRelationshipPromise;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVsYXRpb25zaGlwUHJvbWlzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9maWVsZHMvcmljaFRleHQvcmVsYXRpb25zaGlwUHJvbWlzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFHQSwrREFBNEQ7QUFDNUQseUNBQXNDO0FBeUIvQixNQUFNLGVBQWUsR0FBRyxDQUFDLEVBQzlCLEdBQUcsRUFDSCxRQUFRLEVBQ1IsT0FBTyxFQUNQLGNBQWMsR0FBRyxLQUFLLEVBQ3RCLEtBQUssRUFDTCxZQUFZLEdBQUcsQ0FBQyxFQUNoQixLQUFLLEVBQ0wsUUFBUSxFQUNSLGdCQUFnQixHQUNJLEVBQVEsRUFBRTtJQUM5QixJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUU7UUFDMUIsUUFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTs7WUFDdEMsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUUsVUFBVSxDQUFDLENBQUM7WUFFNUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssY0FBYyxJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDO29CQUM3RCxNQUFBLE9BQU8sYUFBUCxPQUFPLHVCQUFQLE9BQU8sQ0FBRSxLQUFLLDBDQUFFLEVBQUUsQ0FBQTttQkFDbEIsVUFBVTttQkFDVixDQUFDLEtBQUssSUFBSSxZQUFZLElBQUksS0FBSyxDQUFDLEVBQUU7Z0JBQ3JDLElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxRQUFRLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFBLE1BQUEsTUFBQSxNQUFBLEtBQUssQ0FBQyxLQUFLLDBDQUFFLE1BQU0sMENBQUUsV0FBVywwQ0FBRyxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUUsVUFBVSxDQUFDLDBDQUFFLE1BQU0sQ0FBQyxFQUFFO29CQUMvRyxJQUFBLHlDQUFtQixFQUFDO3dCQUNsQixRQUFRO3dCQUNSLElBQUksRUFBRSxPQUFPLENBQUMsTUFBTSxJQUFJLEVBQUU7d0JBQzFCLE1BQU0sRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU07d0JBQ2pFLEdBQUc7d0JBQ0gsT0FBTzt3QkFDUCxjQUFjO3dCQUNkLEtBQUs7d0JBQ0wsWUFBWTt3QkFDWixnQkFBZ0I7cUJBQ2pCLENBQUMsQ0FBQztpQkFDSjtnQkFDRCxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUEsbUJBQVEsRUFBQztvQkFDckIsR0FBRztvQkFDSCxFQUFFLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO29CQUNwQixJQUFJLEVBQUUsT0FBTztvQkFDYixHQUFHLEVBQUUsT0FBTztvQkFDWixjQUFjO29CQUNkLEtBQUs7b0JBQ0wsWUFBWTtvQkFDWixPQUFPO29CQUNQLEtBQUs7b0JBQ0wsVUFBVTtvQkFDVixnQkFBZ0I7aUJBQ2pCLENBQUMsQ0FBQyxDQUFDO2FBQ0w7WUFFRCxJQUFJLE9BQU8sYUFBUCxPQUFPLHVCQUFQLE9BQU8sQ0FBRSxRQUFRLEVBQUU7Z0JBQ3JCLElBQUEsdUJBQWUsRUFBQztvQkFDZCxHQUFHO29CQUNILFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtvQkFDMUIsT0FBTztvQkFDUCxjQUFjO29CQUNkLEtBQUs7b0JBQ0wsWUFBWTtvQkFDWixLQUFLO29CQUNMLFFBQVE7b0JBQ1IsZ0JBQWdCO2lCQUNqQixDQUFDLENBQUM7YUFDSjtRQUNILENBQUMsQ0FBQyxDQUFDO0tBQ0o7QUFDSCxDQUFDLENBQUM7QUE5RFcsUUFBQSxlQUFlLG1CQThEMUI7QUFFRixNQUFNLDJCQUEyQixHQUFHLENBQUMsRUFDbkMsR0FBRyxFQUNILElBQUksRUFDSixPQUFPLEVBQ1AsY0FBYyxFQUNkLEtBQUssRUFDTCxZQUFZLEVBQ1osS0FBSyxFQUNMLGdCQUFnQixHQUNOLEVBQUUsRUFBRSxDQUFDLEtBQUssSUFBbUIsRUFBRTtJQUN6QyxNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFFcEIsSUFBQSx1QkFBZSxFQUFDO1FBQ2QsR0FBRztRQUNILFFBQVEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztRQUMxQixPQUFPO1FBQ1AsY0FBYztRQUNkLEtBQUs7UUFDTCxZQUFZO1FBQ1osS0FBSztRQUNMLFFBQVE7UUFDUixnQkFBZ0I7S0FDakIsQ0FBQyxDQUFDO0lBRUgsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzlCLENBQUMsQ0FBQztBQUVGLGtCQUFlLDJCQUEyQixDQUFDIn0=