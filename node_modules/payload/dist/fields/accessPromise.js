"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const relationshipPopulationPromise_1 = __importDefault(require("./relationshipPopulationPromise"));
const accessPromise = async ({ data, fullData, field, operation, overrideAccess, req, id, relationshipPopulations, depth, currentDepth, hook, payload, showHiddenFields, originalDoc, }) => {
    const resultingData = data;
    let accessOperation;
    if (hook === 'afterRead') {
        accessOperation = 'read';
    }
    else if (hook === 'beforeValidate') {
        if (operation === 'update')
            accessOperation = 'update';
        if (operation === 'create')
            accessOperation = 'create';
    }
    if (field.access && field.access[accessOperation]) {
        const result = overrideAccess ? true : await field.access[accessOperation]({ req, id, siblingData: data, data: fullData, doc: originalDoc });
        if (!result) {
            delete resultingData[field.name];
        }
    }
    if ((field.type === 'relationship' || field.type === 'upload') && hook === 'afterRead') {
        relationshipPopulations.push((0, relationshipPopulationPromise_1.default)({
            showHiddenFields,
            data,
            field,
            depth,
            currentDepth,
            req,
            overrideAccess,
            payload,
        }));
    }
};
exports.default = accessPromise;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjZXNzUHJvbWlzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9maWVsZHMvYWNjZXNzUHJvbWlzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLG9HQUE0RTtBQXFCNUUsTUFBTSxhQUFhLEdBQUcsS0FBSyxFQUFFLEVBQzNCLElBQUksRUFDSixRQUFRLEVBQ1IsS0FBSyxFQUNMLFNBQVMsRUFDVCxjQUFjLEVBQ2QsR0FBRyxFQUNILEVBQUUsRUFDRix1QkFBdUIsRUFDdkIsS0FBSyxFQUNMLFlBQVksRUFDWixJQUFJLEVBQ0osT0FBTyxFQUNQLGdCQUFnQixFQUNoQixXQUFXLEdBQ0QsRUFBaUIsRUFBRTtJQUM3QixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUM7SUFFM0IsSUFBSSxlQUFlLENBQUM7SUFFcEIsSUFBSSxJQUFJLEtBQUssV0FBVyxFQUFFO1FBQ3hCLGVBQWUsR0FBRyxNQUFNLENBQUM7S0FDMUI7U0FBTSxJQUFJLElBQUksS0FBSyxnQkFBZ0IsRUFBRTtRQUNwQyxJQUFJLFNBQVMsS0FBSyxRQUFRO1lBQUUsZUFBZSxHQUFHLFFBQVEsQ0FBQztRQUN2RCxJQUFJLFNBQVMsS0FBSyxRQUFRO1lBQUUsZUFBZSxHQUFHLFFBQVEsQ0FBQztLQUN4RDtJQUVELElBQUksS0FBSyxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxFQUFFO1FBQ2pELE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLENBQUMsQ0FBQztRQUU3SSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ1gsT0FBTyxhQUFhLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2xDO0tBQ0Y7SUFFRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxjQUFjLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsSUFBSSxJQUFJLEtBQUssV0FBVyxFQUFFO1FBQ3RGLHVCQUF1QixDQUFDLElBQUksQ0FBQyxJQUFBLHVDQUE2QixFQUFDO1lBQ3pELGdCQUFnQjtZQUNoQixJQUFJO1lBQ0osS0FBSztZQUNMLEtBQUs7WUFDTCxZQUFZO1lBQ1osR0FBRztZQUNILGNBQWM7WUFDZCxPQUFPO1NBQ1IsQ0FBQyxDQUFDLENBQUM7S0FDTDtBQUNILENBQUMsQ0FBQztBQUVGLGtCQUFlLGFBQWEsQ0FBQyJ9