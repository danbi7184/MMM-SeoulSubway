"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const deepmerge_1 = __importDefault(require("deepmerge"));
const validationPromise = async ({ errors, hook, originalDoc, fullOriginalDoc, data, fullData, id, field, path, skipValidation, user, operation, }) => {
    if (hook !== 'beforeChange' || skipValidation)
        return true;
    const hasCondition = field.admin && field.admin.condition;
    const shouldValidate = field.validate && !hasCondition;
    let valueToValidate = data === null || data === void 0 ? void 0 : data[field.name];
    if (valueToValidate === undefined)
        valueToValidate = originalDoc === null || originalDoc === void 0 ? void 0 : originalDoc[field.name];
    if (valueToValidate === undefined)
        valueToValidate = field.defaultValue;
    const result = shouldValidate ? await field.validate(valueToValidate, {
        ...field,
        data: (0, deepmerge_1.default)(fullOriginalDoc, fullData),
        siblingData: (0, deepmerge_1.default)(originalDoc, data),
        id,
        operation,
        user,
    }) : true;
    if (typeof result === 'string') {
        errors.push({
            message: result,
            field: `${path}${field.name}`,
        });
    }
    return result;
};
exports.default = validationPromise;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvblByb21pc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZmllbGRzL3ZhbGlkYXRpb25Qcm9taXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMERBQThCO0FBb0I5QixNQUFNLGlCQUFpQixHQUFHLEtBQUssRUFBRSxFQUMvQixNQUFNLEVBQ04sSUFBSSxFQUNKLFdBQVcsRUFDWCxlQUFlLEVBQ2YsSUFBSSxFQUNKLFFBQVEsRUFDUixFQUFFLEVBQ0YsS0FBSyxFQUNMLElBQUksRUFDSixjQUFjLEVBQ2QsSUFBSSxFQUNKLFNBQVMsR0FDQyxFQUE2QixFQUFFO0lBQ3pDLElBQUksSUFBSSxLQUFLLGNBQWMsSUFBSSxjQUFjO1FBQUUsT0FBTyxJQUFJLENBQUM7SUFFM0QsTUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQztJQUMxRCxNQUFNLGNBQWMsR0FBRyxLQUFLLENBQUMsUUFBUSxJQUFJLENBQUMsWUFBWSxDQUFDO0lBRXZELElBQUksZUFBZSxHQUFHLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekMsSUFBSSxlQUFlLEtBQUssU0FBUztRQUFFLGVBQWUsR0FBRyxXQUFXLGFBQVgsV0FBVyx1QkFBWCxXQUFXLENBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQy9FLElBQUksZUFBZSxLQUFLLFNBQVM7UUFBRSxlQUFlLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQztJQUV4RSxNQUFNLE1BQU0sR0FBRyxjQUFjLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLFFBQVEsQ0FBQyxlQUFlLEVBQUU7UUFDcEUsR0FBRyxLQUFLO1FBQ1IsSUFBSSxFQUFFLElBQUEsbUJBQUssRUFBQyxlQUFlLEVBQUUsUUFBUSxDQUFDO1FBQ3RDLFdBQVcsRUFBRSxJQUFBLG1CQUFLLEVBQUMsV0FBVyxFQUFFLElBQUksQ0FBQztRQUNyQyxFQUFFO1FBQ0YsU0FBUztRQUNULElBQUk7S0FDTCxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUVWLElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxFQUFFO1FBQzlCLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDVixPQUFPLEVBQUUsTUFBTTtZQUNmLEtBQUssRUFBRSxHQUFHLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxFQUFFO1NBQzlCLENBQUMsQ0FBQztLQUNKO0lBRUQsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyxDQUFDO0FBRUYsa0JBQWUsaUJBQWlCLENBQUMifQ==